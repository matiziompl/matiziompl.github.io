<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Rewersyjny licznik JK – X=0 i X=1 razem</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      padding: 5px;
      text-align: center;
    }
    input { width: 30px; text-align: center; }
    h3 { margin-top: 40px; }
  </style>
</head>
<body>
<nav>
    <a href="index.html">Zad 1 i 2</a> |
    <a href="zad_3_JK.html">Zad 3 JK</a> |
    <a href="zad_3_D.html">Zad 3 D</a>
</nav>
<h2>Wprowadź kolejne stany Q<sub>C</sub>, Q<sub>B</sub>, Q<sub>A</sub> (kolejność licznika):</h2>
<table id="stateTable">
  <tr><th>Stan</th><th>Q<sub>C</sub></th><th>Q<sub>B</sub></th><th>Q<sub>A</sub></th></tr>
  <script>
    for (let i = 0; i < 8; i++) {
      document.write(`<tr>
        <td>${i}</td>
        <td><input id="qc${i}" maxlength="1"></td>
        <td><input id="qb${i}" maxlength="1"></td>
        <td><input id="qa${i}" maxlength="1"></td>
      </tr>`);
    }
  </script>
</table>

<br>
<button onclick="runJK()">Oblicz JK i generuj tablice Karnaugha</button>

<div id="output"></div>

<script>
  function jk(q, qp) {
    if (q === 0 && qp === 0) return [0, '-'];
    if (q === 0 && qp === 1) return [1, '-'];
    if (q === 1 && qp === 0) return ['-', 1];
    if (q === 1 && qp === 1) return ['-', 0];
  }

  function runJK() {
    let transitions = [];
    for (let i = 0; i < 8; i++) {
      const qc = parseInt(document.getElementById(`qc${i}`).value);
      const qb = parseInt(document.getElementById(`qb${i}`).value);
      const qa = parseInt(document.getElementById(`qa${i}`).value);
      if ([qc, qb, qa].some(x => isNaN(x))) {
        alert("Uzupełnij wszystkie pola wartościami 0 lub 1.");
        return;
      }
      transitions.push([qc, qb, qa]);
    }

    const JA = [], KA = [], JB = [], KB = [], JC = [], KC = [];

    // przejścia dla każdej kombinacji X, Qc, Qb, Qa
    for (let X = 0; X <= 1; X++) {
      for (let i = 0; i < 8; i++) {
        const [qc, qb, qa] = transitions[i];

        // przy X=1 – przejście do przodu; X=0 – przejście do tyłu
        let nextIndex = (X === 1) ? (i + 1) % 8 : (i + 7) % 8;
        const [qcp, qbp, qap] = transitions[nextIndex];

        const [ja, ka] = jk(qa, qap);
        const [jb, kb] = jk(qb, qbp);
        const [jc, kc] = jk(qc, qcp);

        JA.push({x: X, qc, qb, qa, val: ja});
        KA.push({x: X, qc, qb, qa, val: ka});
        JB.push({x: X, qc, qb, qa, val: jb});
        KB.push({x: X, qc, qb, qa, val: kb});
        JC.push({x: X, qc, qb, qa, val: jc});
        KC.push({x: X, qc, qb, qa, val: kc});
      }
    }

    const output = document.getElementById("output");
    output.innerHTML =
      generateKMap("J_A", JA) +
      generateKMap("K_A", KA) +
      generateKMap("J_B", JB) +
      generateKMap("K_B", KB) +
      generateKMap("J_C", JC) +
      generateKMap("K_C", KC);
  }

    function generateKMap(name, data) {
    // Kolumny w standardowej kolejności kodu Graya
    const grayColumns = [[0,0], [0,1], [1,1], [1,0]]; // kolejność 00, 01, 11, 10
    // Wiersze w zmienionej kolejności
    const grayRows = [[0,0], [0,1], [1,1], [1,0]]; // kolejność 00, 10, 11, 01
    
    let html = `<h3>${name}</h3><table><tr><th>XQ<sub>C</sub> \\ Q<sub>B</sub>Q<sub>A</sub></th>`;
    for (let [qb, qa] of grayColumns) html += `<th>${qb}${qa}</th>`;
    html += "</tr>";
    
    for (let [x, qc] of grayRows) {
        html += `<tr><th>${x}${qc}</th>`;
        for (let [qb, qa] of grayColumns) {
        const found = data.find(e =>
            e.x === x && e.qc === qc && e.qb === qb && e.qa === qa
        );
        html += `<td>${found ? found.val : "-"}</td>`;
        }
        html += "</tr>";
    }
    html += "</table>";
    return html;
    }

</script>

</body>
</html>